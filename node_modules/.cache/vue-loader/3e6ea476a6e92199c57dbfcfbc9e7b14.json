{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\src\\views\\shop\\applyShop.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\src\\views\\shop\\applyShop.vue","mtime":1596790763906},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBzaG9wSXRlbSBmcm9tICdAY29tcG9uZW50cy9zaG9wL3Nob3BJdGVtJwppbXBvcnQgeyBtYXBHZXR0ZXJzLCBtYXBBY3Rpb25zLCBtYXBNdXRhdGlvbnMgfSBmcm9tICJ2dWV4IjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnYXBwbHlTaG9wJywKICBtaXhpbnM6IFtdLAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBHZXR0ZXJzKFsibG9jYXRpb25JbmZvIiwgImxvY2F0aW9uQ2l0eSJdKQogIH0sCiAgY29tcG9uZW50czp7CiAgICBzaG9wSXRlbQogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHZvdWNoZXJJZDogdGhpcy4kcm91dGUucXVlcnkudm91Y2hlcklkLAogICAgICBkaXNjb3VudFNob3BMaXN0OiBbXQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgLy8g6YCC55So5ZWG5a62CiAgICBnZXREaXNjb3VudFNob3AocGFnZSA9IDEpIHsKICAgICAgaWYodGhpcy5sb2FkaW5nKSByZXR1cm4KICAgICAgdGhpcy5sb2FkaW5nID0gdHJ1ZSAKICAgICAgbGV0IGRhdGEgPSB7CiAgICAgICAgdm91Y2hlcklkOiB0aGlzLnZvdWNoZXJJZCwKICAgICAgICBjaXR5SWQ6IHRoaXMubG9jYXRpb25DaXR5LmNpdHlJZCwKICAgICAgICBsYXQ6IHRoaXMubG9jYXRpb25JbmZvLmxhdGl0dWRlLAogICAgICAgIGxuZzogdGhpcy5sb2NhdGlvbkluZm8ubG9uZ2l0dWRlLAogICAgICB9CiAgICAgIGRhdGEucGFnZSA9IHBhZ2UKICAgICAgZGF0YS5wZXJTaXplID0gMTAKICAgICAgdGhpcy4kYXBpLmNhc2hfcmVkX2FibGVfc2hvcChkYXRhKS50aGVuKHJlcyA9PiB7CiAgICAgICAgaWYgKHJlcy5zdGF0ZSkgewogICAgICAgICAgbGV0IGRpc2NvdW50U2hvcExpc3QgPSByZXMuaW5mby5zaG9wTGlzdCB8fCBbXQogICAgICAgICAgdGhpcy5oYW5kbGVyTGlzdChkaXNjb3VudFNob3BMaXN0LCBwYWdlKQogICAgICAgICAgaWYgKHBhZ2UgPT0gMSkgewogICAgICAgICAgICB0aGlzLnRvdGFsUGFnZSA9IHJlcy5pbmZvLnBhZ2UudG90YWxQYWdlCiAgICAgICAgICB9CiAgICAgICAgICB0aGlzLnBhZ2UgPSBwYWdlCiAgICAgICAgICAKICAgICAgICAgIGlmIChwYWdlID09IHRoaXMudG90YWxQYWdlKSB7CiAgICAgICAgICAgIHRoaXMuaGFzTW9yZSA9IGZhbHNlIC8vIOaYvuekuuW3sue7j+WIsOW6leS6hgogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgdGhpcy5oYXNNb3JlID0gdHJ1ZQogICAgICAgICAgfQogICAgICAgIH0KICAgICAgfSkuZmluYWxseSgoKSA9PiB7CiAgICAgICAgdGhpcy5sb2FkaW5nID0gZmFsc2UKICAgICAgfSkKICAgIH0sCgogICAgLy8g5aSE55CG5YiX6KGo5pWw5o2uCiAgICBoYW5kbGVyTGlzdChkaXNjb3VudFNob3BMaXN0LCBwYWdlKSB7CiAgICAgIGRpc2NvdW50U2hvcExpc3QuZm9yRWFjaCgoaXRlbSkgPT4gewogICAgICAgIGxldCBjYXJkTGlzdCA9IGl0ZW0uY2FyZExpc3QgfHwgW10KICAgICAgICBpZiAoY2FyZExpc3QubGVuZ3RoID4gMCkgewogICAgICAgICAgbGV0IGJhY2sgPSB0aGlzLnVuaXF1ZShpdGVtLmNhcmRMaXN0KQogICAgICAgICAgaXRlbS5xX3N0ciA9IGJhY2tbJ3Ffc3RyJ10KICAgICAgICAgIGl0ZW0udF9zdHIgPSBiYWNrWyd0X3N0ciddCiAgICAgICAgfQogICAgICB9KQoKICAgICAgbGV0IF9saXN0ID0gdGhpcy5kaXNjb3VudFNob3BMaXN0IHx8IFtdCiAgICAgIGlmKHBhZ2UgPT0gMSkgewogICAgICAgIF9saXN0ID0gZGlzY291bnRTaG9wTGlzdAogICAgICB9IGVsc2UgewogICAgICAgIF9saXN0LnB1c2goLi4uZGlzY291bnRTaG9wTGlzdCkKICAgICAgfQogICAgICB0aGlzLmRpc2NvdW50U2hvcExpc3QgPSBfbGlzdAogICAgfSwKCiAgICAvLyDmlbDnu4Tljrvph40KICAgIHVuaXF1ZShhcnIpIHsKICAgICAgdmFyIHJlc3VsdCA9IFtdOwogICAgICBsZXQgcV9hcnIgPSBbXQogICAgICBsZXQgdF9hcnIgPSBbXQogICAgICBsZXQgcV9zdHIgPSAnJwogICAgICBsZXQgdF9zdHIgPSAnJwogICAgICB2YXIgb2JqID0ge307CiAgICAgIC8vIGNvbnNvbGUubG9nKGFyciwgJ2FycmFycicpCiAgICAgIGZvcih2YXIgaSA9MDsgaSA8IGFyci5sZW5ndGg7IGkrKyl7CiAgICAgICAgaWYoIW9ialthcnJbaV0uY2FyZE5hbWVdIHx8IG9ialthcnJbaV0uY2FyZE5hbWVdLnVzZUNvbmRpdGlvbiAhPSBhcnJbaV0udXNlQ29uZGl0aW9uKXsKICAgICAgICAgIHJlc3VsdC5wdXNoKGFycltpXSkKICAgICAgICAgIG9ialthcnJbaV0uY2FyZE5hbWVdID0gYXJyW2ldCiAgICAgICAgfQogICAgICB9CgogICAgICAvLyDlpITnkIbljrvph43lkI7nmoTmlbDnu4QKICAgICAgZm9yICh2YXIgaSA9MDsgaSA8IHJlc3VsdC5sZW5ndGg7IGkrKykgewogICAgICAgIGlmKHJlc3VsdFtpXS5jYXJkVHlwZSA9PSAiQ0FSRF9DQVNIX0NPVVBPTiIpIHsKICAgICAgICAgIHFfYXJyLnB1c2gocmVzdWx0W2ldKQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICB0X2Fyci5wdXNoKHJlc3VsdFtpXSkKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGlmKHFfYXJyLmxlbmd0aCA+IDApIHsKICAgICAgICBmb3IobGV0IGkgPTA7IGkgPCBxX2Fyci5sZW5ndGg7IGkrKyl7CiAgICAgICAgICBpZiAocV9hcnJbaV0udXNlQ29uZGl0aW9uID09IDEpIHsgLy8g5Yik5pat5peg6Zeo5qeb5Luj6YeR5Yi4CiAgICAgICAgICAgIHFfc3RyID0gKHFfc3RyID8gcV9zdHIgKyAn77yMJyA6IHFfc3RyKSArIChxX2FycltpXS5zZWxsUHJpY2UgLyAxMDApICsgJ+WFg+aKtScgKyBxX2FycltpXS5jYXJkTmFtZQogICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcV9zdHIgPSAocV9zdHIgPyBxX3N0ciArICfvvIwnIDogcV9zdHIpICsgKHFfYXJyW2ldLnNlbGxQcmljZSAvIDEwMCkgKyAn5YWD6LStJyArIHFfYXJyW2ldLmNhcmROYW1lCiAgICAgICAgICB9CiAgICAgICAgICAKICAgICAgICB9CiAgICAgIH0KICAgICAgLy8gY29uc29sZS5sb2codF9hcnIsICd0X2FycnRfYXJydF9hcnInKQogICAgICBpZiAodF9hcnIubGVuZ3RoPjApIHsKICAgICAgICBmb3IobGV0IGkgPTA7IGkgPCB0X2Fyci5sZW5ndGg7IGkrKyl7CiAgICAgICAgICB0X3N0ciA9ICh0X3N0ciA/IHRfc3RyICsgJ++8jCcgOiB0X3N0cikgKyAodF9hcnJbaV0uc2VsbFByaWNlIC8gMTAwKSArICflhYPotK0nICsgKHRfYXJyW2ldLm9yaWdpbmFsUHJpY2UgLyAxMDApICsgJ+WFgycgKyB0X2FycltpXS5jYXJkTmFtZQogICAgICAgIH0KICAgICAgfQoKICAgICAgcmV0dXJuIHsKICAgICAgICAncV9zdHInOiBxX3N0ciwKICAgICAgICAndF9zdHInOnRfc3RyCiAgICAgIH0KICAgIH0sCiAgfSwKICBjcmVhdGVkKCkgewogICAgdGhpcy5nZXREaXNjb3VudFNob3AoKQogIH0KfQo="},{"version":3,"sources":["applyShop.vue"],"names":[],"mappings":";;;;;;;;;;;;;;AAcA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"applyShop.vue","sourceRoot":"src/views/shop","sourcesContent":["<!--\r\n * @Description: 适用店铺\r\n * @Version: 1.0\r\n * @Autor: cherry\r\n * @Date: 2020-07-17 15:36:02\r\n * @LastEditors: cherry\r\n * @LastEditTime: 2020-08-07 15:07:28\r\n--> \r\n<template>\r\n  <div>\r\n    <shop-item v-for=\"(item, index) in discountShopList\" :key=\"index\" :item=\"item\"></shop-item>\r\n  </div>\r\n</template>\r\n<script>\r\n  import shopItem from '@components/shop/shopItem'\r\n  import { mapGetters, mapActions, mapMutations } from \"vuex\";\r\n\r\n  export default {\r\n    name: 'applyShop',\r\n    mixins: [],\r\n    computed: {\r\n      ...mapGetters([\"locationInfo\", \"locationCity\"])\r\n    },\r\n    components:{\r\n      shopItem\r\n    },\r\n    data() {\r\n      return {\r\n        voucherId: this.$route.query.voucherId,\r\n        discountShopList: []\r\n      }\r\n    },\r\n    methods: {\r\n      // 适用商家\r\n      getDiscountShop(page = 1) {\r\n        if(this.loading) return\r\n        this.loading = true \r\n        let data = {\r\n          voucherId: this.voucherId,\r\n          cityId: this.locationCity.cityId,\r\n          lat: this.locationInfo.latitude,\r\n          lng: this.locationInfo.longitude,\r\n        }\r\n        data.page = page\r\n        data.perSize = 10\r\n        this.$api.cash_red_able_shop(data).then(res => {\r\n          if (res.state) {\r\n            let discountShopList = res.info.shopList || []\r\n            this.handlerList(discountShopList, page)\r\n            if (page == 1) {\r\n              this.totalPage = res.info.page.totalPage\r\n            }\r\n            this.page = page\r\n            \r\n            if (page == this.totalPage) {\r\n              this.hasMore = false // 显示已经到底了\r\n            } else {\r\n              this.hasMore = true\r\n            }\r\n          }\r\n        }).finally(() => {\r\n          this.loading = false\r\n        })\r\n      },\r\n\r\n      // 处理列表数据\r\n      handlerList(discountShopList, page) {\r\n        discountShopList.forEach((item) => {\r\n          let cardList = item.cardList || []\r\n          if (cardList.length > 0) {\r\n            let back = this.unique(item.cardList)\r\n            item.q_str = back['q_str']\r\n            item.t_str = back['t_str']\r\n          }\r\n        })\r\n\r\n        let _list = this.discountShopList || []\r\n        if(page == 1) {\r\n          _list = discountShopList\r\n        } else {\r\n          _list.push(...discountShopList)\r\n        }\r\n        this.discountShopList = _list\r\n      },\r\n\r\n      // 数组去重\r\n      unique(arr) {\r\n        var result = [];\r\n        let q_arr = []\r\n        let t_arr = []\r\n        let q_str = ''\r\n        let t_str = ''\r\n        var obj = {};\r\n        // console.log(arr, 'arrarr')\r\n        for(var i =0; i < arr.length; i++){\r\n          if(!obj[arr[i].cardName] || obj[arr[i].cardName].useCondition != arr[i].useCondition){\r\n            result.push(arr[i])\r\n            obj[arr[i].cardName] = arr[i]\r\n          }\r\n        }\r\n\r\n        // 处理去重后的数组\r\n        for (var i =0; i < result.length; i++) {\r\n          if(result[i].cardType == \"CARD_CASH_COUPON\") {\r\n            q_arr.push(result[i])\r\n          } else {\r\n            t_arr.push(result[i])\r\n          }\r\n        }\r\n\r\n        if(q_arr.length > 0) {\r\n          for(let i =0; i < q_arr.length; i++){\r\n            if (q_arr[i].useCondition == 1) { // 判断无门槛代金券\r\n              q_str = (q_str ? q_str + '，' : q_str) + (q_arr[i].sellPrice / 100) + '元抵' + q_arr[i].cardName\r\n            } else {\r\n              q_str = (q_str ? q_str + '，' : q_str) + (q_arr[i].sellPrice / 100) + '元购' + q_arr[i].cardName\r\n            }\r\n            \r\n          }\r\n        }\r\n        // console.log(t_arr, 't_arrt_arrt_arr')\r\n        if (t_arr.length>0) {\r\n          for(let i =0; i < t_arr.length; i++){\r\n            t_str = (t_str ? t_str + '，' : t_str) + (t_arr[i].sellPrice / 100) + '元购' + (t_arr[i].originalPrice / 100) + '元' + t_arr[i].cardName\r\n          }\r\n        }\r\n\r\n        return {\r\n          'q_str': q_str,\r\n          't_str':t_str\r\n        }\r\n      },\r\n    },\r\n    created() {\r\n      this.getDiscountShop()\r\n    }\r\n  }\r\n</script>\r\n<style scoped lang='scss'>\r\n</style>"]}]}