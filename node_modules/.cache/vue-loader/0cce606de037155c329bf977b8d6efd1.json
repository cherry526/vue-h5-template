{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\src\\views\\home\\home.vue?vue&type=style&index=0&id=39f87be5&scoped=true&lang=scss&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\src\\views\\home\\home.vue","mtime":1595906170767},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\sass-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgouaG9tZS1wYWdlIHsKICBwYWRkaW5nLXRvcDogMTAwcHg7CiAgCiAgLnNvcnQtdGFiIHsKICAgIC8vIHBvc2l0aW9uOiBzdGlja3k7CiAgICBwb3NpdGlvbjogZml4ZWQ7CiAgICB0b3A6IDEwMHB4OwogICAgbGVmdDogMDsKICAgIHdpZHRoOiAxMDAlOwogICAgLy8gYmFja2dyb3VuZDogI2Y2ZjZmNjsKICAgIGJhY2tncm91bmQtY29sb3I6ICNmZmY7CiAgICB6LWluZGV4OiAxOwogICAgJi5hY3RpdmUgewogICAgICBiYWNrZ3JvdW5kOiAjZmZmOwogICAgICBib3JkZXItYm90dG9tOiAxcHggc29saWQgI0U1RTZFODsKICAgIH0KICB9Cn0K"},{"version":3,"sources":["home.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA+OA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"home.vue","sourceRoot":"src/views/home","sourcesContent":["<!--\r\n * @Description: 首页\r\n * @Version: 1.0\r\n * @Autor: cherry\r\n * @Date: 2020-07-10 16:38:41\r\n * @LastEditors: cherry\r\n * @LastEditTime: 2020-07-28 11:16:10\r\n--> \r\n<template>\r\n  <div class=\"home-page\">\r\n    <search-tab rightText=\"搜索\"></search-tab>\r\n    <div class=\"sort-tab\" :class=\"tacActive ? 'border':''\" id=\"sort-tab\" bindtap=\"tabClick\">\r\n      <sort-tab \r\n        :business=\"business\"\r\n        :category=\"category\"\r\n        :sort=\"sort\"\r\n        :cityId.sync=\"cityId\" \r\n        :type=\"pageType\"  \r\n        isShowDiscount \r\n        @changemask=\"changemask\"\r\n        @changeList=\"changeList\" \r\n        :refresh=\"refresh\"\r\n      >\r\n      </sort-tab>\r\n    </div>\r\n\r\n    <router-link  to=\"/shop/applyShop\">适用门店{{locationInfo.lat}}</router-link>\r\n    <router-link  to=\"/coupon/couponList\">我的卡券</router-link>\r\n    <router-link  to=\"/active/specialSale\">特卖活动</router-link>\r\n    <router-link  to=\"/shop/applyAddressShop\">适用门店</router-link>\r\n    <router-link  to=\"/active/giftBag\">大礼包</router-link>\r\n\r\n\r\n    <div class=\"act-list\">\r\n      <active-item v-for=\"(item, index) in list\" :key=\"index\" :item=\"item\"></active-item>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\n  // import actions from '@utils/actions'\r\n  import { mapGetters, mapActions, mapMutations } from \"vuex\";\r\n  import activeItem from '@components/active/activeItem'\r\n  export default {\r\n    name: 'home',\r\n    components:{\r\n      activeItem\r\n    },\r\n    data() {\r\n      return {\r\n        filterKeywordList:[],\r\n        tacActive: false,\r\n        list: [],\r\n        business: '商圈·全城',\r\n        category: '全部品类',\r\n        sort: '综合排序',\r\n        cityId: 0,\r\n        refresh: true,\r\n        filterItem: null,\r\n        pageType: 2,\r\n        totalPage: 0,\r\n        filterId: 0,\r\n        filterData: {}\r\n      }\r\n    },\r\n    computed: {\r\n      ...mapGetters([\"locationInfo\", \"locationCity\"])\r\n    },\r\n    methods: {\r\n      // tab栏动画\r\n      tabClick(e){\r\n        console.log(e, '999999999999999999')\r\n        if(this.tacActive) return\r\n        // let curScrollTop = e.currentTarget.offsetTop\r\n        // setTimeout(() => {\r\n        //   this.setData({ \r\n        //     floorstatus: false\r\n        //   })\r\n        // }, 100)\r\n        \r\n      },\r\n      // 筛选组件回调\r\n      changeList(e) {\r\n        // let query = e.detail\r\n        let query = e\r\n        let tabtype = query.tabtype // 判断是点击哪个tab。当前tab取e.detail里面的参数，其他tab取this.data\r\n        let aid, bid, cid, type, range, sorttype, discountRange;\r\n        if(tabtype == 0){\r\n          ({ aid, bid = 0, type, range = 0 }  = query);\r\n          ({ cid, sorttype, discountRange } = this)\r\n        } else if(tabtype == 1) {\r\n          ({ cid, type }  = query);\r\n          ({ aid, range, bid, sorttype, discountRange } = this)\r\n        } else if(tabtype == 2) {\r\n          ({ sorttype, type }  = query);\r\n          ({ aid, range, bid, cid, discountRange } = this)\r\n        } else if(tabtype == 3) {\r\n          ({ discountRange, type }  = query);\r\n          ({ aid, range, bid, cid, sorttype } = this)\r\n        }\r\n          this.aid = aid\r\n          this.range = range \r\n          this.bid = bid \r\n          this.cid = cid\r\n          this.sorttype = sorttype\r\n          this.discountRange = discountRange\r\n          this.type = type\r\n        let data = {\r\n          cityId: this.cityId,\r\n          range: range,\r\n          type,// 1.附近 2.商圈 3地区 4.分类 5.综合排序 6折扣筛选\r\n          areaId: aid, // 一级地区id\r\n          busCircleId: bid, //一级地区id（商圈Id）\r\n          // ctgId1: pcid, //一级品类Id (暂时不用)\r\n          ctgId: cid, // 二级品类Id，\r\n          sortType: sorttype, //筛选：1.综合排序 2人气最高 3.距离优先 4.人均最低 5人均最高\r\n          discountRange: discountRange, //折扣：格式'8|10'\r\n          lng: this.locationInfo.longitude,\r\n          lat: this.locationInfo.longitude,\r\n          filterId: 0\r\n        }\r\n        this.filterData = data\r\n        this.getList()\r\n      },\r\n      changemask(e) {\r\n        // this.setData({\r\n        //   f_mask: e.detail,\r\n        //   hideFilter: !this.hideFilter\r\n        // })\r\n      },\r\n      init () {\r\n        let data = {\r\n          cityId: this.locationCity.cityId,\r\n          range: 0,\r\n          type: 1,// 1.附近 2.商圈 3地区 4.分类 5.综合排序 6折扣筛选\r\n          areaId: 0, // 一级地区id\r\n          busCircleId: 0, //一级地区id（商圈Id）\r\n          ctgId: 0, // 二级品类Id，\r\n          sortType: 1, //筛选：1.综合排序 2人气最高 3.距离优先 4.人均最低 5人均最高\r\n          discountRange: 0, //折扣：格式'8|10'\r\n          lng: this.locationInfo.longitude,\r\n          lat: this.locationInfo.longitude,\r\n          filterId: 0\r\n        }\r\n        this.filterData = data\r\n        this.cityId = this.locationCity.cityId,\r\n        this.getList()\r\n        this.getFilterList()\r\n      },\r\n\r\n      // 推荐商家关键字&栏目名称\r\n      getFilterList() {\r\n        this.$api.filtrate_list({\r\n          cityId: this.locationCity.cityId,\r\n          moduleId: 0,\r\n          indexType: this.pageType //1.推荐商家 2.精选特卖 3.返现商家\r\n        }).then(res => {\r\n          if (res.state) {\r\n            this.filterKeywordList = [...this.filterKeywordList, ...res.info.filterKeywordList]\r\n          }\r\n        })\r\n      },\r\n\r\n      // 获取列表\r\n      getList(page = 1) {\r\n        // 接口配置\r\n        let apiData = {\r\n          1: {url: 'recommend_shop', listName: 'shopList'},\r\n          2: {url: 'specialSellList', listName: 'actList'},\r\n          3: {url: 'hot_cashback', listName: 'cashBackShopList'},\r\n        }\r\n        let apiUrl = apiData[this.pageType]\r\n        let data = this.filterData\r\n        data.filterId = this.filterId\r\n        if(this.listLoading) return\r\n        if(page > this.totalPage && page != 1) return\r\n        this.listLoading = true\r\n        data.page = page\r\n        data.perSize = 10\r\n        data.moduleId = 0\r\n        console.log(apiUrl, '单独列表')\r\n        this.$api[apiUrl.url](data).then(res=> {\r\n          if (res.state) {\r\n            let list = res.info[apiUrl.listName] || []\r\n            if (page == 1) {\r\n              this.totalPage = res.info.page.totalPage\r\n            }\r\n            if (page == this.totalPage) {\r\n              this.hasMore = false // 显示已经到底了\r\n            }\r\n            if (this.pageType == 1) { // 商家列表时需处理数据\r\n              this.handlerList(list, page)\r\n            } else {\r\n              this.list = [...this.list, ...list]\r\n            }\r\n            this.page = page\r\n          }\r\n        }).finally(() => {\r\n          this.listLoading = false\r\n          this.loading = false\r\n        })\r\n      },\r\n\r\n      // 处理商家列表数据\r\n      handlerList(discountShopList, page) {\r\n        discountShopList.forEach((item) => {\r\n          let cardList = item.cardList || []\r\n          if (cardList.length > 0) {\r\n            let back = unique(item.cardList)\r\n            item.q_str = back['q_str']\r\n            item.t_str = back['t_str']\r\n          }\r\n        })\r\n\r\n        let _list = this.list || []\r\n        if(page == 1) {\r\n          _list = discountShopList\r\n        } else {\r\n          _list.push(...discountShopList)\r\n        }\r\n        this.list = _list\r\n      }\r\n    },\r\n    created() {\r\n      this.init()\r\n    //  setTimeout(() => {\r\n    //   actions.share({\r\n    //     title: '邀请加入店铺', // 分享标题\r\n    //     desc: '哈咯哈咯哈',\r\n    //     url: 'http://107d.kdwaimai.com',\r\n    //     data: {\r\n    //       name: 'cherry',\r\n    //       url: 'http://107d.kdwaimai.com'\r\n    //     }\r\n    //   })\r\n    //  }, 500)\r\n    }\r\n  }\r\n</script>\r\n<style scoped lang='scss'>\r\n  .home-page {\r\n    padding-top: 100px;\r\n    \r\n    .sort-tab {\r\n      // position: sticky;\r\n      position: fixed;\r\n      top: 100px;\r\n      left: 0;\r\n      width: 100%;\r\n      // background: #f6f6f6;\r\n      background-color: #fff;\r\n      z-index: 1;\r\n      &.active {\r\n        background: #fff;\r\n        border-bottom: 1px solid #E5E6E8;\r\n      }\r\n    }\r\n  }\r\n</style>"]}]}