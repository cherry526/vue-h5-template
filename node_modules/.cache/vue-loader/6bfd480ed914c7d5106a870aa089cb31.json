{"remainingRequest":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\src\\views\\shop\\applyShop.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\src\\views\\shop\\applyShop.vue","mtime":1596624611576},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\babel-loader\\lib\\index.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"C:\\Users\\Administrator\\Desktop\\vip_inline_h5\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBzaG9wSXRlbSBmcm9tICdAY29tcG9uZW50cy9zaG9wL3Nob3BJdGVtJwppbXBvcnQgeyBtYXBHZXR0ZXJzLCBtYXBBY3Rpb25zLCBtYXBNdXRhdGlvbnMgfSBmcm9tICJ2dWV4IjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAnYXBwbHlTaG9wJywKICBtaXhpbnM6IFtdLAogIGNvbXB1dGVkOiB7CiAgICAuLi5tYXBHZXR0ZXJzKFsibG9jYXRpb25JbmZvIiwgImxvY2F0aW9uQ2l0eSJdKQogIH0sCiAgY29tcG9uZW50czp7CiAgICBzaG9wSXRlbQogIH0sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIHZvdWNoZXJJZDogdGhpcy4kcm91dGUucXVlcnkudm91Y2hlcklkCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICAvLyDpgILnlKjllYblrrYKICAgIGdldERpc2NvdW50U2hvcChwYWdlID0gMSkgewogICAgICBpZih0aGlzLmxvYWRpbmcpIHJldHVybgogICAgICB0aGlzLmxvYWRpbmcgPSB0cnVlIAogICAgICBsZXQgZGF0YSA9IHsKICAgICAgICB2b3VjaGVySWQ6IHRoaXMudm91Y2hlcklkLAogICAgICAgIGNpdHlJZDogdGhpcy5sb2NhdGlvbkNpdHkuY2l0eUlkLAogICAgICAgIGxhdDogdGhpcy5sb2NhdGlvbkluZm8ubGF0aXR1ZGUsCiAgICAgICAgbG5nOiB0aGlzLmxvY2F0aW9uSW5mby5sb25naXR1ZGUsCiAgICAgIH0KICAgICAgZGF0YS5wYWdlID0gcGFnZQogICAgICBkYXRhLnBlclNpemUgPSAxMAogICAgICB0aGlzLiRhcGkuY2FzaF9yZWRfYWJsZV9zaG9wKGRhdGEpLnRoZW4ocmVzID0+IHsKICAgICAgICBpZiAocmVzLnN0YXRlKSB7CiAgICAgICAgICBsZXQgZGlzY291bnRTaG9wTGlzdCA9IHJlcy5pbmZvLnNob3BMaXN0IHx8IFtdCiAgICAgICAgICB0aGlzLmhhbmRsZXJMaXN0KGRpc2NvdW50U2hvcExpc3QsIHBhZ2UpCiAgICAgICAgICBpZiAocGFnZSA9PSAxKSB7CiAgICAgICAgICAgIHRoaXMudG90YWxQYWdlID0gcmVzLmluZm8ucGFnZS50b3RhbFBhZ2UKICAgICAgICAgIH0KICAgICAgICAgIHRoaXMucGFnZSA9IHBhZ2UKICAgICAgICAgIAogICAgICAgICAgaWYgKHBhZ2UgPT0gdGhpcy50b3RhbFBhZ2UpIHsKICAgICAgICAgICAgdGhpcy5oYXNNb3JlID0gZmFsc2UgLy8g5pi+56S65bey57uP5Yiw5bqV5LqGCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0aGlzLmhhc01vcmUgPSB0cnVlCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICB9KS5maW5hbGx5KCgpID0+IHsKICAgICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQogICAgICB9KQogICAgfSwKCiAgICAvLyDlpITnkIbliJfooajmlbDmja4KICAgIGhhbmRsZXJMaXN0KGRpc2NvdW50U2hvcExpc3QsIHBhZ2UpIHsKICAgICAgZGlzY291bnRTaG9wTGlzdC5mb3JFYWNoKChpdGVtKSA9PiB7CiAgICAgICAgbGV0IGNhcmRMaXN0ID0gaXRlbS5jYXJkTGlzdCB8fCBbXQogICAgICAgIGlmIChjYXJkTGlzdC5sZW5ndGggPiAwKSB7CiAgICAgICAgICBsZXQgYmFjayA9IHRoaXMudW5pcXVlKGl0ZW0uY2FyZExpc3QpCiAgICAgICAgICBpdGVtLnFfc3RyID0gYmFja1sncV9zdHInXQogICAgICAgICAgaXRlbS50X3N0ciA9IGJhY2tbJ3Rfc3RyJ10KICAgICAgICB9CiAgICAgIH0pCgogICAgICBsZXQgX2xpc3QgPSB0aGlzLmRpc2NvdW50U2hvcExpc3QgfHwgW10KICAgICAgaWYocGFnZSA9PSAxKSB7CiAgICAgICAgX2xpc3QgPSBkaXNjb3VudFNob3BMaXN0CiAgICAgIH0gZWxzZSB7CiAgICAgICAgX2xpc3QucHVzaCguLi5kaXNjb3VudFNob3BMaXN0KQogICAgICB9CiAgICAgIHRoaXMuZGlzY291bnRTaG9wTGlzdCA9IF9saXN0CiAgICB9LAoKICAgIC8vIOaVsOe7hOWOu+mHjQogICAgdW5pcXVlKGFycikgewogICAgICB2YXIgcmVzdWx0ID0gW107CiAgICAgIGxldCBxX2FyciA9IFtdCiAgICAgIGxldCB0X2FyciA9IFtdCiAgICAgIGxldCBxX3N0ciA9ICcnCiAgICAgIGxldCB0X3N0ciA9ICcnCiAgICAgIHZhciBvYmogPSB7fTsKICAgICAgLy8gY29uc29sZS5sb2coYXJyLCAnYXJyYXJyJykKICAgICAgZm9yKHZhciBpID0wOyBpIDwgYXJyLmxlbmd0aDsgaSsrKXsKICAgICAgICBpZighb2JqW2FycltpXS5jYXJkTmFtZV0gfHwgb2JqW2FycltpXS5jYXJkTmFtZV0udXNlQ29uZGl0aW9uICE9IGFycltpXS51c2VDb25kaXRpb24pewogICAgICAgICAgcmVzdWx0LnB1c2goYXJyW2ldKQogICAgICAgICAgb2JqW2FycltpXS5jYXJkTmFtZV0gPSBhcnJbaV0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8vIOWkhOeQhuWOu+mHjeWQjueahOaVsOe7hAogICAgICBmb3IgKHZhciBpID0wOyBpIDwgcmVzdWx0Lmxlbmd0aDsgaSsrKSB7CiAgICAgICAgaWYocmVzdWx0W2ldLmNhcmRUeXBlID09ICJDQVJEX0NBU0hfQ09VUE9OIikgewogICAgICAgICAgcV9hcnIucHVzaChyZXN1bHRbaV0pCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHRfYXJyLnB1c2gocmVzdWx0W2ldKQogICAgICAgIH0KICAgICAgfQoKICAgICAgaWYocV9hcnIubGVuZ3RoID4gMCkgewogICAgICAgIGZvcihsZXQgaSA9MDsgaSA8IHFfYXJyLmxlbmd0aDsgaSsrKXsKICAgICAgICAgIGlmIChxX2FycltpXS51c2VDb25kaXRpb24gPT0gMSkgeyAvLyDliKTmlq3ml6Dpl6jmp5vku6Pph5HliLgKICAgICAgICAgICAgcV9zdHIgPSAocV9zdHIgPyBxX3N0ciArICfvvIwnIDogcV9zdHIpICsgKHFfYXJyW2ldLnNlbGxQcmljZSAvIDEwMCkgKyAn5YWD5oq1JyArIHFfYXJyW2ldLmNhcmROYW1lCiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICBxX3N0ciA9IChxX3N0ciA/IHFfc3RyICsgJ++8jCcgOiBxX3N0cikgKyAocV9hcnJbaV0uc2VsbFByaWNlIC8gMTAwKSArICflhYPotK0nICsgcV9hcnJbaV0uY2FyZE5hbWUKICAgICAgICAgIH0KICAgICAgICAgIAogICAgICAgIH0KICAgICAgfQogICAgICAvLyBjb25zb2xlLmxvZyh0X2FyciwgJ3RfYXJydF9hcnJ0X2FycicpCiAgICAgIGlmICh0X2Fyci5sZW5ndGg+MCkgewogICAgICAgIGZvcihsZXQgaSA9MDsgaSA8IHRfYXJyLmxlbmd0aDsgaSsrKXsKICAgICAgICAgIHRfc3RyID0gKHRfc3RyID8gdF9zdHIgKyAn77yMJyA6IHRfc3RyKSArICh0X2FycltpXS5zZWxsUHJpY2UgLyAxMDApICsgJ+WFg+i0rScgKyAodF9hcnJbaV0ub3JpZ2luYWxQcmljZSAvIDEwMCkgKyAn5YWDJyArIHRfYXJyW2ldLmNhcmROYW1lCiAgICAgICAgfQogICAgICB9CgogICAgICByZXR1cm4gewogICAgICAgICdxX3N0cic6IHFfc3RyLAogICAgICAgICd0X3N0cic6dF9zdHIKICAgICAgfQogICAgfSwKICB9LAogIGNyZWF0ZWQoKSB7CiAgICB0aGlzLmdldERpc2NvdW50U2hvcCgpCiAgfQp9Cg=="},{"version":3,"sources":["applyShop.vue"],"names":[],"mappings":";;;;;;;;;;;;;;AAcA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"applyShop.vue","sourceRoot":"src/views/shop","sourcesContent":["<!--\r\n * @Description: 适用店铺\r\n * @Version: 1.0\r\n * @Autor: cherry\r\n * @Date: 2020-07-17 15:36:02\r\n * @LastEditors: cherry\r\n * @LastEditTime: 2020-08-03 14:32:20\r\n--> \r\n<template>\r\n  <div>\r\n    <shop-item v-for=\"(item, index) in list\" :key=\"index\" :item=\"item\"></shop-item>\r\n  </div>\r\n</template>\r\n<script>\r\n  import shopItem from '@components/shop/shopItem'\r\n  import { mapGetters, mapActions, mapMutations } from \"vuex\";\r\n\r\n  export default {\r\n    name: 'applyShop',\r\n    mixins: [],\r\n    computed: {\r\n      ...mapGetters([\"locationInfo\", \"locationCity\"])\r\n    },\r\n    components:{\r\n      shopItem\r\n    },\r\n    data() {\r\n      return {\r\n        voucherId: this.$route.query.voucherId\r\n      }\r\n    },\r\n    methods: {\r\n      // 适用商家\r\n      getDiscountShop(page = 1) {\r\n        if(this.loading) return\r\n        this.loading = true \r\n        let data = {\r\n          voucherId: this.voucherId,\r\n          cityId: this.locationCity.cityId,\r\n          lat: this.locationInfo.latitude,\r\n          lng: this.locationInfo.longitude,\r\n        }\r\n        data.page = page\r\n        data.perSize = 10\r\n        this.$api.cash_red_able_shop(data).then(res => {\r\n          if (res.state) {\r\n            let discountShopList = res.info.shopList || []\r\n            this.handlerList(discountShopList, page)\r\n            if (page == 1) {\r\n              this.totalPage = res.info.page.totalPage\r\n            }\r\n            this.page = page\r\n            \r\n            if (page == this.totalPage) {\r\n              this.hasMore = false // 显示已经到底了\r\n            } else {\r\n              this.hasMore = true\r\n            }\r\n          }\r\n        }).finally(() => {\r\n          this.loading = false\r\n        })\r\n      },\r\n\r\n      // 处理列表数据\r\n      handlerList(discountShopList, page) {\r\n        discountShopList.forEach((item) => {\r\n          let cardList = item.cardList || []\r\n          if (cardList.length > 0) {\r\n            let back = this.unique(item.cardList)\r\n            item.q_str = back['q_str']\r\n            item.t_str = back['t_str']\r\n          }\r\n        })\r\n\r\n        let _list = this.discountShopList || []\r\n        if(page == 1) {\r\n          _list = discountShopList\r\n        } else {\r\n          _list.push(...discountShopList)\r\n        }\r\n        this.discountShopList = _list\r\n      },\r\n\r\n      // 数组去重\r\n      unique(arr) {\r\n        var result = [];\r\n        let q_arr = []\r\n        let t_arr = []\r\n        let q_str = ''\r\n        let t_str = ''\r\n        var obj = {};\r\n        // console.log(arr, 'arrarr')\r\n        for(var i =0; i < arr.length; i++){\r\n          if(!obj[arr[i].cardName] || obj[arr[i].cardName].useCondition != arr[i].useCondition){\r\n            result.push(arr[i])\r\n            obj[arr[i].cardName] = arr[i]\r\n          }\r\n        }\r\n\r\n        // 处理去重后的数组\r\n        for (var i =0; i < result.length; i++) {\r\n          if(result[i].cardType == \"CARD_CASH_COUPON\") {\r\n            q_arr.push(result[i])\r\n          } else {\r\n            t_arr.push(result[i])\r\n          }\r\n        }\r\n\r\n        if(q_arr.length > 0) {\r\n          for(let i =0; i < q_arr.length; i++){\r\n            if (q_arr[i].useCondition == 1) { // 判断无门槛代金券\r\n              q_str = (q_str ? q_str + '，' : q_str) + (q_arr[i].sellPrice / 100) + '元抵' + q_arr[i].cardName\r\n            } else {\r\n              q_str = (q_str ? q_str + '，' : q_str) + (q_arr[i].sellPrice / 100) + '元购' + q_arr[i].cardName\r\n            }\r\n            \r\n          }\r\n        }\r\n        // console.log(t_arr, 't_arrt_arrt_arr')\r\n        if (t_arr.length>0) {\r\n          for(let i =0; i < t_arr.length; i++){\r\n            t_str = (t_str ? t_str + '，' : t_str) + (t_arr[i].sellPrice / 100) + '元购' + (t_arr[i].originalPrice / 100) + '元' + t_arr[i].cardName\r\n          }\r\n        }\r\n\r\n        return {\r\n          'q_str': q_str,\r\n          't_str':t_str\r\n        }\r\n      },\r\n    },\r\n    created() {\r\n      this.getDiscountShop()\r\n    }\r\n  }\r\n</script>\r\n<style scoped lang='scss'>\r\n</style>"]}]}